function substitute(e,a){return e.replace(/\{([^{}]+)\}/g,function(e,t){var n=a[t];return void 0!==n?""+n:""})}function getEvents(e){url=get_events_url;for(var a in param)url+=a+"="+param[a]+"&&";$.getJSON(url,function(a){for(var t="",n=$(".more"),i=0;i<a.length;i++)t+=a[i].begin_date==a[i].end_date?substitute(item_template_sameday,a[i]):substitute(item_template_diffday,a[i]);"more"==e?""!=t?($(".event-list").append(t),n.text("摸摸我，加载更多"),n.removeClass("loading")):n.text("没有了"):($(".event-list").html(t),""!=t?a.length==param.every_page?(n.text("摸摸我，加载更多"),n.removeClass("loading")):(n.text("没有了"),n.addClass("loading")):(n.text("无结果"),n.addClass("loading")))})}function bindEvent(){$(".more").bind("click",function(){var e=$(".more");return e.hasClass("loading")?!1:(param.page++,e.addClass("loading"),e.text("正在努力获取数据..."),getEvents("more"),void 0)}),$(".events-nav-item a").bind("click",function(){var e=$(this).parent(),a=$(".more");if(e.hasClass("current"))return!1;$(".event-list").html(""),a.addClass("loading"),a.text("正在努力获取数据..."),$(this).parents("ul").children("li").removeClass("current"),e.addClass("current");var t=$(this).attr("href").split("-");return param[t[0]]=t[1],param.page=0,getEvents("new"),!1})}var get_events_url="http://localhost/~kjlmfe/slimevent/m/find?",param=[];param.category="all",param.region="all",param.range="week",param.page=0,param.order="post",param.by="desc",param.every_page=5;var item_template_sameday="<li><h2><a target='_blank' href='/event/{eid}?mobile=1'>[{category}] {title}</a></h2><div class='info'><ul><li>时间: {begin_date} ({begin_weekday}) {begin_time} - {end_time} ({begin_remain_day})</li><li>地点: {region} {addr}</li><li>发起: <a target='_blank' href='/user/{organizer_id}?mobile=1'>{organizer}</a></li> </ul></div></li>",item_template_diffday="<li><h2><a target='_blank' href='/event/{eid}?mobile=1'>[{category}] {title}</a></h2><div class='info'><ul><li>开始时间: {begin_date} ({begin_weekday}) {begin_time} ({begin_remain_day})</li><li>结束时间: {end_date} ({end_weekday}) {end_time} ({end_remain_day})</li><li>地点: {region} {addr}</li><li>发起: <a target='_blank' href='/user/{organizer_id}?mobile=1'>{organizer}</a></li> </ul></div></li>";$(function(){bindEvent(),getEvents("new")});